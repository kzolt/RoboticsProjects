#pragma config(Sensor, dgtl1,  FrontInput,     sensorSONAR_inch)
#pragma config(Sensor, dgtl3,  LeftInput,      sensorSONAR_inch)
#pragma config(Sensor, dgtl5,  RightInput,     sensorSONAR_inch)
#pragma config(Motor,  port3,           LeftMotor,     tmotorVex393_MC29, openLoop, driveLeft)
#pragma config(Motor,  port4,           RightMotor,    tmotorVex393_MC29, openLoop, driveRight)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

#define MIN_THRESHOLD 12

/**************************************************
 * STRUCTS AND EUMS
 **************************************************/

// Simple Two Dimenstional Vector Struct
typedef struct vector_2_float
{
	float x, y;
} Vector2f;

// Robot struct
typedef struct robot
{
	int left_speed;
	int right_speed;
	Vector2f dir_vec;
} Robot;

/**************************************************
 * GLOBALS
 **************************************************/

// Global Robot 'Object'
Robot rbot;

/**************************************************
 * FUNCTIONS
 **************************************************/

// Setups Robots Defaults
void init_robot()
{
	rbot.left_speed = 0;
	rbot.right_speed = 0;
	rbot.dir_vec.x = 0;
	rbot.dir_vec.y = 0;
}

// Figures out if there is something in it's way and modifies vectors in order not to hit it
void figure_out_location()
{
	// Vertical Vector
	if (SensorValue[FrontInput] < MIN_THRESHOLD)
		rbot.dir_vec.y = 0;
	else
		rbot.dir_vec.y = 127;

	// Horizontal Vector
	if (SensorValue[LeftInput] < MIN_THRESHOLD || SensorValue[RightInput] < MIN_THRESHOLD)
		rbot.dir_vec.x = (SensorValue[LeftInput] < MIN_THRESHOLD ? -127 : 127);
	else
		rbot.dir_vec.x = 0;
}

// Moves the robot around
void move_robot()
{
	// Changes Robots Vectors
	figure_out_location();	

	// Slow Down one motor if x axis has input
	if (rbot.dir_vec.x < 0)
		rbot.right_speed -= rbot.dir_vec.x;
	else if(rbot.dir_vec.x > 0)
		rbot.left_speed += rbot.dir_vec.x;

	// if y axis doesn't have input but the x axis does then spin
	if ((int)rbot.dir_vec.y == 0 && (int)rbot.dir_vec.x < 0 || (int)rbot.dir_vec.x > 0)
	{
		rbot.left_speed = rbot.dir_vec.y;
		rbot.right_speed = rbot.dir_vec.y;
	}

	motor[LeftMotor] = rbot.left_speed;
	motor[RightMotor] = rbot.right_speed;
}

task main()
{
	// Initialize the robot
	init_robot();

	// Main loop
	while (true)
	{
		move_robot();
	}

}
